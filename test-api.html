<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Gemini</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .result { background: #e7f3ff; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .error { background: #ffe7e7; color: #d63384; }
        .success { background: #e7f9e7; color: #198754; }
    </style>
</head>
<body>
    <h1>üß† Test de l'int√©gration API Gemini</h1>
    
    <div class="container">
        <h3>Configuration</h3>
        <label>Cl√© API Gemini:</label>
        <input type="password" id="apiKey" placeholder="Votre cl√© API Gemini">
        <button onclick="testConnection()">Tester la connexion</button>
    </div>

    <div class="container">
        <h3>Test d'auto-remplissage</h3>
        <label>Intitul√© du poste:</label>
        <input type="text" id="jobTitle" placeholder="ex: D√©veloppeur Full Stack H/F" value="D√©veloppeur Full Stack H/F">
        <button onclick="testAutofill()">G√©n√©rer les donn√©es</button>
    </div>

    <div id="result" class="result" style="display: none;">
        <h3>R√©sultat:</h3>
        <div id="resultContent"></div>
    </div>

    <script>
        async function testConnection() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                showResult('Veuillez entrer une cl√© API', 'error');
                return;
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "Hello, say 'API working!'" }] }]
                    })
                });

                if (response.ok) {
                    showResult('‚úÖ Connexion API r√©ussie!', 'success');
                } else {
                    showResult(`‚ùå Erreur de connexion: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Erreur: ${error.message}`, 'error');
            }
        }

        async function testAutofill() {
            const apiKey = document.getElementById('apiKey').value;
            const jobTitle = document.getElementById('jobTitle').value;

            if (!apiKey || !jobTitle) {
                showResult('Veuillez remplir tous les champs', 'error');
                return;
            }

            const prompt = `Bas√© sur l'intitul√© de poste "${jobTitle}", fournis-moi les informations suivantes au format JSON strict:

{
  "secteur": "un secteur appropri√©",
  "metier": "un m√©tier appropri√©", 
  "description": "une description d√©taill√©e du poste en 3-4 phrases",
  "competences": "liste des comp√©tences requises s√©par√©es par des virgules",
  "salaire_min": "salaire minimum estim√© en euros (nombre uniquement)",
  "salaire_max": "salaire maximum estim√© en euros (nombre uniquement)",
  "type_contrat": "CDI, CDD, Stage, Interim, Freelance, ou Apprentissage",
  "experience": "nombre d'ann√©es d'exp√©rience minimum requis (nombre uniquement)"
}

R√©ponds uniquement avec le JSON, sans texte suppl√©mentaire.`;

            try {
                showResult('‚è≥ G√©n√©ration en cours...', '');
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // Extraire le JSON
                const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const jobData = JSON.parse(jsonMatch[0]);
                    
                    let html = '<h4>‚úÖ Donn√©es g√©n√©r√©es avec succ√®s:</h4>';
                    html += `<p><strong>Secteur:</strong> ${jobData.secteur}</p>`;
                    html += `<p><strong>M√©tier:</strong> ${jobData.metier}</p>`;
                    html += `<p><strong>Description:</strong> ${jobData.description}</p>`;
                    html += `<p><strong>Comp√©tences:</strong> ${jobData.competences}</p>`;
                    html += `<p><strong>Type contrat:</strong> ${jobData.type_contrat}</p>`;
                    html += `<p><strong>Exp√©rience:</strong> ${jobData.experience} ans minimum</p>`;
                    html += `<p><strong>Salaire:</strong> ${jobData.salaire_min} - ${jobData.salaire_max} ‚Ç¨</p>`;
                    
                    showResult(html, 'success');
                } else {
                    showResult('‚ùå Format JSON non trouv√© dans la r√©ponse', 'error');
                }
            } catch (error) {
                showResult(`‚ùå Erreur: ${error.message}`, 'error');
            }
        }

        function showResult(content, type) {
            const result = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            result.style.display = 'block';
            result.className = `result ${type}`;
            resultContent.innerHTML = content;
        }
    </script>
</body>
</html>
